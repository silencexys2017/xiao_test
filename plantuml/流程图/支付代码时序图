@startuml
title 下单流程时序图

actor         app                as app      order 1
participant   mallAPI            as api      order 2
participant   orderService       as order    order 7
participant   memberService      as member    order 8
database      mongoDb            as db       order 10
entity        lipaPay            as pay      order 11

app -> api: [post] /bill-order-pay/<int:bill_id>  发起支付（增加参数 payCode，phone，email，password，sdkType）
autonumber 1
api -> api: 对增加的参数payCode，sdkType进行默认处理；对password解密
api -> order: get_batch_by_bill_id 获取支付bill的销售订单
activate order
order <-> db: parameter.find_one 查询是否开启cod手机验证
order -> api: bool
deactivate order
api -> auth: get_contact_list 获取手机是否验证
activate auth
auth <-> db: contact.find 查询用户手机相关信息
auth -> api: list<contact>
deactivate auth
api -> api: 验证手机


@enduml